apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: json-to-parquet
spec:
  templates:
    - name: json-to-parquet
      inputs:
        parameters:
          - name: jsonPath
          - name: parquetPath
      volumes:
      - name: data-access-secrets
        secret:
          secretName: data-access
          defaultMode: 256
      script:
        volumeMounts:
        - name: data-access-secrets
          mountPath: /run/data-access
        env:
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /run/data-access/service-account.json
        - name: SPARK_EXECUTOR_IMAGE
          value: {{ index .Values.images "spark" }}
        image: {{ index .Values.images "spark" }}
        imagePullPolicy: IfNotPresent
        command: [bash]
        source: |
          echo {{`{{inputs.parameters.jsonPath}}` | quote }}
          echo {{`{{inputs.parameters.parquetPath}}` | quote }}
